var app = new Vue({
  el:"#app",
  data:{
      money: 0,
      number: null,
      num: [],
      totalPrice: [],
      itemList: [],
      sendData: {},
      inputMoney: null
  },
  methods:{
      buyItem(){
        var self = this;  
        $.ajax({
          url: 'http://localhost:3000/sends/'+self.number,
          type: 'GET',
          dataType:'json',
        }).done(function(res){
           self.itemList.push(res);
           self.money += res.baika;
           self.num.push(1);
           self.totalPrice.push(res.baika);
        });
        self.number = "";
        
        
    },
    changeNumber(price,index){
       this.money -= this.totalPrice[index];
       this.totalPrice[index] = this.num[index] * price;
       this.money += this.totalPrice[index];

    },
    deleteItem(index){
      this.money -= this.totalPrice[index];
      this.totalPrice.splice(index,1);
      this.num.splice(index,1);
      this.itemList.splice(index,1);
    },
    clearMoney(){
      this.datacheck();

    },
    datacheck(){
      var num = this.itemList.length;
      $("#calc-modal").modal('hide');
        for(var i = 0; i< num; i++){
          this.sendData[i]={name: this.itemList[i].name,number: this.num[i]};
          
        }
      if (this.inputMoney > this.money){
       $.ajax({
           url: '/getMoney/'+this.money,
           type: 'POST',
           data: this.sendData,
           dataType:'json',
       }).done(function(){
          console.log('ok');
       }.bind(this),'json');

         this.itemList = [];
         this.num = [];
         this.totalPrice = [];
         this.sendData = {};
      } 
    },
  }
});
